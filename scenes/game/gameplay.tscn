[gd_scene load_steps=43 format=3 uid="uid://lkolhnpo6fuo"]

[ext_resource type="Script" path="res://scripts/game_manager.gd" id="1_noepw"]
[ext_resource type="PackedScene" uid="uid://jr6kks18p32p" path="res://scenes/objects/board.tscn" id="2_7sxhf"]
[ext_resource type="PackedScene" uid="uid://gbg1fq05vnj5" path="res://scenes/objects/token.tscn" id="2_08wbk"]
[ext_resource type="Resource" uid="uid://i85atx5fko2x" path="res://data/tokens_data/chests/0_chest_bronze.tres" id="4_b0hm0"]
[ext_resource type="PackedScene" uid="uid://c1x5lrnrq51io" path="res://scenes/objects/save_token_slot.tscn" id="4_cm6t5"]
[ext_resource type="Script" path="res://scripts/dinasty_manager.gd" id="5_grqs2"]
[ext_resource type="Resource" uid="uid://cv8hu7lvay3x8" path="res://data/tokens_data/misc/rock.tres" id="5_r4yhu"]
[ext_resource type="Script" path="res://scripts/game_ui_manager.gd" id="5_x74f5"]
[ext_resource type="PackedScene" uid="uid://c83iuigvvkkp0" path="res://scenes/objects/cell.tscn" id="6_h3m50"]
[ext_resource type="Script" path="res://scripts/difficulty_manager.gd" id="7_x7uas"]
[ext_resource type="Resource" uid="uid://cn673p2tkxq8o" path="res://data/dinasties/0_dinasty.tres" id="8_3k38h"]
[ext_resource type="Script" path="res://scripts/game_states/state_machine.gd" id="8_umy6w"]
[ext_resource type="Script" path="res://scripts/game_states/state_loading.gd" id="9_kvjog"]
[ext_resource type="Resource" uid="uid://b20sjjtmherem" path="res://data/dinasties/1_dinasty.tres" id="9_ur2yy"]
[ext_resource type="Resource" uid="uid://bpnk3vrw8en7n" path="res://data/dinasties/2_dinasty.tres" id="10_3n31h"]
[ext_resource type="Script" path="res://scripts/combinations/combinator.gd" id="10_dfvt2"]
[ext_resource type="Script" path="res://scripts/game_states/state_player_turn.gd" id="10_s5a4x"]
[ext_resource type="Resource" uid="uid://cj8xmxh73qauy" path="res://data/tokens_data/actions/move.tres" id="11_a37gt"]
[ext_resource type="Resource" uid="uid://bl53r56jlpcem" path="res://data/dinasties/3_dinasty.tres" id="11_pl43k"]
[ext_resource type="Script" path="res://scripts/game_states/state_start.gd" id="11_q468j"]
[ext_resource type="Resource" uid="uid://dttqudoi54l7v" path="res://data/tokens_data/actions/wildcard.tres" id="13_kh2cu"]
[ext_resource type="Resource" uid="uid://bi56svpdbw0wm" path="res://data/tokens_data/actions/bomb.tres" id="13_mgra2"]
[ext_resource type="Resource" uid="uid://dxct4ukary6br" path="res://data/tokens_data/enemies/monokelo.tres" id="15_i3l0h"]
[ext_resource type="Resource" uid="uid://cvercemsw2qwg" path="res://data/tokens_data/misc/grave.tres" id="15_uulqy"]
[ext_resource type="Resource" uid="uid://bbe1iclaj1ifb" path="res://data/tokens_data/actions/level_up.tres" id="16_o7wik"]
[ext_resource type="Script" path="res://scripts/game_states/state_enemies_turn.gd" id="17_7v2y8"]
[ext_resource type="Resource" uid="uid://bdme4fr70c720" path="res://data/dinasties/4_dinasty.tres" id="17_askel"]
[ext_resource type="Script" path="res://scripts/game_states/state_check_game.gd" id="17_uph22"]
[ext_resource type="Script" path="res://scripts/game_states/state_game_over.gd" id="18_34rgb"]
[ext_resource type="PackedScene" uid="uid://sa1kbmcs2338" path="res://ui/screens/gameplay/ui_gameplay.tscn" id="18_65b04"]
[ext_resource type="Resource" uid="uid://b2v2ioxjx6u6q" path="res://data/difficulties/diff_0_easy.tres" id="18_svfu7"]
[ext_resource type="Resource" uid="uid://djp2prybxnb24" path="res://data/difficulties/diff_1_medium.tres" id="19_etvjp"]
[ext_resource type="Script" path="res://scenes/game/fx_manager.gd" id="20_bux8w"]
[ext_resource type="Resource" uid="uid://c64d1bd8mq5b5" path="res://data/difficulties/diff_2_hard.tres" id="20_dtr34"]
[ext_resource type="Resource" uid="uid://cmq51686lyrpw" path="res://data/tokens_data/actions/remove_all.tres" id="20_op0by"]
[ext_resource type="PackedScene" uid="uid://bfsbokyqcnf6x" path="res://scenes/effects/bomb_explosion.tscn" id="21_55vwk"]
[ext_resource type="Resource" uid="uid://dy163nmcgs5yx" path="res://data/tokens_data/combinables/grass/0_grass.tres" id="21_ajspr"]
[ext_resource type="Resource" uid="uid://yclnnytw230n" path="res://data/tokens_data/combinables/grass/1_bush.tres" id="22_62cki"]
[ext_resource type="PackedScene" uid="uid://1rbab57s5yio" path="res://scenes/effects/select_cell.tscn" id="22_x53b4"]
[ext_resource type="Resource" uid="uid://kccdpfen1pu7" path="res://data/tokens_data/combinables/grass/2_tree.tres" id="23_fc6dr"]
[ext_resource type="Resource" uid="uid://bfrohevgij67i" path="res://data/tokens_data/combinables/gates/0_lamp.tres" id="24_oikmj"]
[ext_resource type="Resource" uid="uid://djp2f3ai1cvxq" path="res://data/tokens_data/combinables/gates/1_shimai.tres" id="25_wbqej"]

[node name="Gameplay" type="Node2D"]
position = Vector2(0, 1)

[node name="GameManager" type="Node" parent="." node_paths=PackedStringArray("dinasty_manager", "difficulty_manager", "game_ui_manager", "fx_manager", "combinator", "board", "spawn_token_cell", "gameplay_ui")]
script = ExtResource("1_noepw")
dinasty_manager = NodePath("../DinastyManager")
difficulty_manager = NodePath("../DifficultyManager")
game_ui_manager = NodePath("../GameUIManager")
fx_manager = NodePath("../FxManager")
combinator = NodePath("../Combinator")
token_scene = ExtResource("2_08wbk")
cell_scene = ExtResource("6_h3m50")
save_token_slot_scene = ExtResource("4_cm6t5")
board = NodePath("../Board")
spawn_token_cell = NodePath("../SpawnTokenCell")
gameplay_ui = NodePath("../UI")
default_chest = ExtResource("4_b0hm0")
bad_token = ExtResource("5_r4yhu")

[node name="GameUIManager" type="Node" parent="."]
script = ExtResource("5_x74f5")

[node name="DifficultyManager" type="Node" parent="."]
script = ExtResource("7_x7uas")

[node name="DinastyManager" type="Node" parent="."]
script = ExtResource("5_grqs2")

[node name="Combinator" type="Node" parent="."]
script = ExtResource("10_dfvt2")

[node name="Board" parent="." instance=ExtResource("2_7sxhf")]
position = Vector2(72, 713)

[node name="SpawnTokenCell" parent="." instance=ExtResource("6_h3m50")]
position = Vector2(170, 426)
highlight_valid = Color(0.5, 1, 0.5, 1)
highlight_invalid = Color(1, 0.5, 0.5, 1)

[node name="SaveTokenCell" parent="." instance=ExtResource("6_h3m50")]
position = Vector2(532, 441)
highlight_valid = Color(0.5, 1, 0.5, 1)
highlight_invalid = Color(1, 0.5, 0.5, 1)

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("game_manager", "board")]
script = ExtResource("8_umy6w")
game_manager = NodePath("../GameManager")
board = NodePath("../Board")

[node name="StateLoading" type="Node" parent="StateMachine" node_paths=PackedStringArray("ui_manager")]
script = ExtResource("9_kvjog")
ordered_dinasties = Array[Resource("res://resources/dinasty.gd")]([ExtResource("8_3k38h"), ExtResource("9_ur2yy"), ExtResource("10_3n31h"), ExtResource("11_pl43k"), ExtResource("17_askel")])
ordered_difficulties = Array[Resource("res://resources/difficulty.gd")]([ExtResource("18_svfu7"), ExtResource("19_etvjp"), ExtResource("20_dtr34")])
landscape_tokens = Array[Resource("res://resources/token_data.gd")]([ExtResource("21_ajspr"), ExtResource("22_62cki"), ExtResource("23_fc6dr"), ExtResource("24_oikmj"), ExtResource("25_wbqej"), ExtResource("15_i3l0h")])
ui_manager = NodePath("../../GameUIManager")

[node name="StateStart" type="Node" parent="StateMachine"]
script = ExtResource("11_q468j")

[node name="StateEnemiesTurn" type="Node" parent="StateMachine" node_paths=PackedStringArray("combinator")]
script = ExtResource("17_7v2y8")
grave_data = ExtResource("15_uulqy")
combinator = NodePath("../../Combinator")

[node name="StatePlayer" type="Node" parent="StateMachine" node_paths=PackedStringArray("combinator")]
script = ExtResource("10_s5a4x")
combinator = NodePath("../../Combinator")
scroll_tokens = Array[Resource("res://resources/token_data.gd")]([ExtResource("11_a37gt"), ExtResource("13_kh2cu"), ExtResource("13_mgra2"), ExtResource("15_i3l0h"), ExtResource("16_o7wik"), ExtResource("4_b0hm0"), ExtResource("20_op0by")])

[node name="GameOverState" type="Node" parent="StateMachine"]
script = ExtResource("18_34rgb")

[node name="CheckState" type="Node" parent="StateMachine"]
script = ExtResource("17_uph22")

[node name="UI" parent="." instance=ExtResource("18_65b04")]

[node name="FxManager" type="Node2D" parent="." node_paths=PackedStringArray("board")]
script = ExtResource("20_bux8w")
board = NodePath("../Board")
fx_bomb_explosion_scene = ExtResource("21_55vwk")
fx_select_cell_scene = ExtResource("22_x53b4")

[node name="SelectCellAnims" type="Node2D" parent="FxManager"]

[connection signal="gold_updated" from="GameManager" to="UI" method="_on_game_manager_gold_updated"]
[connection signal="points_added" from="GameManager" to="DifficultyManager" method="_on_game_manager_points_added"]
[connection signal="points_added" from="GameManager" to="DinastyManager" method="_on_game_manager_points_added"]
[connection signal="show_floating_reward" from="GameManager" to="UI" method="_on_game_manager_show_floating_reward"]
[connection signal="show_message" from="GameManager" to="UI" method="_on_game_manager_show_message"]
[connection signal="difficulty_changed" from="DifficultyManager" to="GameManager" method="_on_difficulty_manager_difficulty_changed"]
[connection signal="dinasty_changed" from="DinastyManager" to="GameManager" method="_on_dinasty_manager_dinasty_changed"]
[connection signal="play_again" from="UI" to="StateMachine/GameOverState" method="_on_ui_play_again"]
